<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Espace Ã‰tudiant - Profil & Emploi du temps & Notes</title>
<style>
header {
    background-color: #14532d; /* Ø£Ø®Ø¶Ø± Ø¯Ø§ÙƒÙ† */
    color: #fefce8;
    width: 100%;
    height: 10vh; /* Ø§Ø³ØªØ®Ø¯Ù… ÙˆØ­Ø¯Ø© vh Ù„ØªÙƒÙˆÙ† Ù†Ø³Ø¨Ø© Ù…Ù† Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø´Ø§Ø´Ø© */
    text-align: center;
    font-family: Arial, Helvetica, sans-serif;
    position: relative;
    
}

main {
    background-color: #ecfdf5; /* Ø£Ø®Ø¶Ø± ÙØ§ØªØ­ Ø¬Ø¯Ù‹Ø§ */
    width:20%;
    height: 80vh; /* Ù†Ø³Ø¨Ø© Ù…Ù† Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø´Ø§Ø´Ø© */
    position: fixed;
    border-right: 3px solid #14532d;

}

nav {
    height: 80vh;
    width: 80%;
    margin-left: 20%; /* Ù…ØªØ³Ø§ÙˆÙŠ Ù…Ø¹ Ø¹Ø±Ø¶ main */
    background-color: #f8fafc; /* Ø£Ø¨ÙŠØ¶ Ù…Ø§Ø¦Ù„ Ù„Ù„Ø±Ù…Ø§Ø¯ÙŠ */
    position: fixed;

}

footer {
    width: 100%;
    height: 10vh;
    background-color: chartreuse;
    position: fixed; /* Ø§Ù„ÙÙˆØªØ± Ø«Ø§Ø¨Øª ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ */
    bottom: 0;
    left: 0;
    text-align: center;
    line-height: 10vh; /* Ù„ØªÙ…Ø±ÙƒØ² Ø§Ù„Ù†Øµ Ø¹Ù…ÙˆØ¯ÙŠØ§Ù‹ */
}

.profile {
    display: flex;
    align-items: center;
    gap: 15px;
}

.profile-img {
    width: 80px;
    border-radius: 50%;
    border: 3px solid #ca8a04; /* Ø°Ù‡Ø¨ÙŠ */
}

.butto{ margin-top: 30px;
     display: flex; 
     flex-direction: column;
      gap: 12px; }

.butto button{ padding: 12px;
     border: none;
      border-radius: 10px;
       font-weight: bold; 
       cursor: pointer; 
       background-color: #166534; /* Ø£Ø®Ø¶Ø± */ 
       color: #fefce8; } 
.butto button:hover{ background-color: #ca8a04;
    color: #14532d; }

.emploi-table {
    border-collapse: collapse;
}

.emploi-table th,
.emploi-table td {
    border: 1px solid #ccc;
    padding: 10px;
    text-align: center;
}

.emploi-table th {
    background-color: #1d3557;
    color: white;
}

.emploi-table tr:nth-child(even) {
    background-color: #f1f5f9;
}
#ex {
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    border: none;
      border-radius: 10px;
       font-weight: bold; 
       cursor: pointer; 
       background-color: red; /* Ø£Ø®Ø¶Ø± */ 
       color: #fefce8; 
       
}


</style>
<header>
 <h1> Espace Ã‰tudiant</h1>
 <div id="exit"><button type="button" id="ex">return</button></div>
</header>

<main>
   <div class="profile">
    <img src="OIP.jpg" class="profile-img">
    <div class="info">
        <p><strong>Nom :</strong> <span id="name"></span></p>
        <p><strong>Email :</strong> <span id="email"></span></p>
    </div>
</div>
<div class="butto">
    <button id="show_note">voir mes notes</button><br>
    <button id="show_emploi">voir mon emploi</button><br>
    <button id="remarque">le nouveau</button>
</div>

</main>
<nav >
    <div id="notes" style="display: none;">
  <h2>ğŸ“Š Mes Notes</h2>

  <table border="1" width="100%" id="notesTable" >
    <thead>
      <tr>
        <th>MatiÃ¨re</th>
        <th>Note</th>
      </tr>
    </thead>
    <tbody>
      <!-- les notes vont Ãªtre ajoutÃ©es ici -->
    </tbody>
  </table>
</div>
<nav>
  <!-- EMPLOI -->
  <div id="emploi" style="display: none;" >
    <h2>ğŸ“… Emploi du temps</h2>

    <table class="emploi-table" >
      <tr>
        <th>Jour</th>
        <th>Heure</th>
        <th>MatiÃ¨re</th>
        <th>Salle</th>
      </tr>

      <tr>
        <td>Lundi</td>
        <td>08:00 - 10:00</td>
        <td>Math</td>
        <td>A1</td>
      </tr>

      <tr>
        <td>Mardi</td>
        <td>10:00 - 12:00</td>
        <td>Informatique</td>
        <td>Lab 2</td>
      </tr>

      <tr>
        <td>Mercredi</td>
        <td>14:00 - 16:00</td>
        <td>Physique</td>
        <td>B3</td>
      </tr>
    </table>
  </div>
<div id="new" style="display: none;">
    nothing for now
</div>

</nav>


</nav>
</body>
<footer>
    <center><h1>bon courage</h1></center>
</footer>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="supabase.js"></script>
<script>
document.getElementById("show_emploi").onclick = () => {
  document.getElementById("emploi").style.display = "block";
  document.getElementById("notes").style.display = "none";
  document.getElementById("new").style.display = "none";
};

document.getElementById("show_note").onclick = () => {
  document.getElementById("notes").style.display = "block";
  document.getElementById("emploi").style.display = "none";
  document.getElementById("new").style.display = "none";
  afficherNotes();
};
document.getElementById("remarque").onclick = () => {
  document.getElementById("notes").style.display = "none";
  document.getElementById("emploi").style.display = "none";
  document.getElementById("new").style.display = "block";
};
document.getElementById("ex").addEventListener('click',exit);
function exit(){
    window.location.href="index.html";
}

  async function afficherNotes() {
    const supabase = window.supabaseClient;
const currentStudentName = localStorage.getItem('currentStudentName');

  if (!currentStudentName) {
    alert("Erreur: nom d'Ã©tudiant non trouvÃ©.");
    return;
  }

    // Ù‡Ù†Ø§ ØªØ¬Ù„Ø¨ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø¬Ø¯ÙˆÙ„ note
    const { data: notes, error } = await supabase
      .from('note')
      .select('matiere, note')
       .eq('nom',currentStudentName);
    if (error) {
      alert('Erreur lors de rÃ©cupÃ©ration des notes: ' + error.message);
      return;
    }

    const tbody = document.querySelector('#notesTable tbody');
    tbody.innerHTML = ''; // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©

    if (!notes || notes.length === 0) {
      const tr = document.createElement('tr');
      const td = document.createElement('td');
      td.colSpan = 2;
      td.textContent = 'Aucune note trouvÃ©e.';
      td.style.textAlign = 'center';
      tr.appendChild(td);
      tbody.appendChild(tr);
      return;
    }

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙÙˆÙ Ù„ÙƒÙ„ Ù…Ù„Ø§Ø­Ø¸Ø©
    notes.forEach(note => {
      const tr = document.createElement('tr');

      const tdMatiere = document.createElement('td');
      tdMatiere.textContent = note.matiere;

      const tdNote = document.createElement('td');
      tdNote.textContent = note.note;

      tr.appendChild(tdMatiere);
      tr.appendChild(tdNote);

      tbody.appendChild(tr);
    });
  }
window.addEventListener('load', async () => {
  const supabase = window.supabaseClient;

  // Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
  const currentStudentName = localStorage.getItem('currentStudentName');

  if (!currentStudentName) {
    alert("Erreur: nom d'Ã©tudiant non trouvÃ©.");
    return;
  }

  // Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³Ù… ÙÙŠ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ø®ØµØµ
  document.getElementById('name').textContent = currentStudentName;

  // Ø·Ù„Ø¨ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ù† Ø¬Ø¯ÙˆÙ„ etudiant Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³Ù…
  const { data: etudiant, error } = await supabase
    .from('etudiant')
    .select('email')
    .eq('nom', currentStudentName)
    .limit(1)
    .single();

  if (error) {
    alert("Erreur lors de la rÃ©cupÃ©ration des infos: " + error.message);
    return;
  }

  // Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
  if (etudiant && etudiant.email) {
    document.getElementById('email').textContent = etudiant.email;
  } else {
    document.getElementById('email').textContent = "Email non trouvÃ©";
  }
});
  // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø£Ùˆ Ø¹Ù†Ø¯ Ø­Ø¯Ø« Ù…Ø¹ÙŠÙ†
  window.addEventListener('load', afficherNotes);
</script>
</html>
